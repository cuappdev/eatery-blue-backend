generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CampusArea {
  WEST
  NORTH
  CENTRAL
  COLLEGETOWN
  NONE
}

enum PaymentMethods {
  MEAL_SWIPE
  CASH
  CARD
  BRB
}

enum EateryType {
  DINING_ROOM
  CAFE
  COFFEE_SHOP
}

enum EventType {
  BREAKFAST
  BRUNCH
  LUNCH
  DINNER
  GENERAL
  CAFE // Used for dummy event for Cafe eateries (ones with no menus)
  PANTS // Pants
}

enum DietaryPreferences {
  VEGAN
  VEGETARIAN
  PESCATARIAN
  HALAL
  KOSHER
  GLUTEN_FREE
}

enum Allergens {
  GLUTEN
  NUTS
  SEAFOOD
  LACTOSE
}

model Eatery {
  id             Int              @id @default(autoincrement())
  cornellId      Int?
  announcements  String[]
  name           String
  shortName      String
  about          String
  cornellDining  Boolean
  menuSummary    String
  imageUrl       String
  campusArea     CampusArea
  onlineOrderUrl String
  contactPhone   String
  contactEmail   String
  latitude       Float
  longitude      Float
  location       String
  paymentMethods PaymentMethods[]
  eateryType     EateryType
  createdAt      DateTime         @default(now())

  events            Event[]
  user              User?             @relation(fields: [userId], references: [id])
  userId            Int?
  favoritedEateries FavoritedEatery[]
  reports           Report[]
}

model Event {
  id             Int       @id @default(autoincrement())
  type           EventType
  date           DateTime
  startTimestamp Int
  endTimestamp   Int
  upvotes        Int
  downvotes      Int
  createdAt      DateTime

  eatery   Eatery @relation(fields: [eateryId], references: [id])
  eateryId Int

  menu Category[]

  @@index([date])
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime

  event   Event  @relation(fields: [eventId], references: [id])
  eventId Int
  items   Item[]
}

model Item {
  id                 Int                  @id @default(autoincrement())
  name               String
  basePrice          Int
  dietaryPreferences DietaryPreferences[]
  allergens          Allergens[]
  createdAt          DateTime

  category       Category        @relation(fields: [categoryId], references: [id])
  categoryId     Int
  user           User?           @relation(fields: [userId], references: [id])
  userId         Int?
  favoritedItems FavoritedItem[]
}

model User {
  id       Int    @id @default(autoincrement())
  deviceId String

  favoriteEateries  Eatery[]
  favoriteItems     Item[]
  fcmTokens         FCMToken[]
  reports           Report[]
  favoritedEateries FavoritedEatery[]
  favoritedItems    FavoritedItem[]
}

model FavoritedEatery {
  user     User   @relation(fields: [userId], references: [id])
  userId   Int
  eatery   Eatery @relation(fields: [eateryId], references: [id])
  eateryId Int

  @@id([userId, eateryId])
}

model FavoritedItem {
  user   User @relation(fields: [userId], references: [id])
  userId Int
  item   Item @relation(fields: [itemId], references: [id])
  itemId Int

  @@id([userId, itemId])
}

model FCMToken {
  id    Int    @id @default(autoincrement())
  token String

  user   User @relation(fields: [userId], references: [id])
  userId Int
}

model Report {
  id        Int      @id @default(autoincrement())
  netid     String
  content   String
  createdAt DateTime

  user     User   @relation(fields: [userId], references: [id])
  userId   Int
  eatery   Eatery @relation(fields: [eateryId], references: [id])
  eateryId Int
}
